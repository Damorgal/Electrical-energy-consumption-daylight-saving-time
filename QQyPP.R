#-----------------------------------------------------------------------------------------------------------
#------------------------------------ Graficas PP ----------------------------------------------------------
#----------------------------------- Octubre 2019 ----------------------------------------------------------
#----------------------------- Diego Aarón Moreno Galván ---------------------------------------------------
#-----------------------------------------------------------------------------------------------------------

#-----------------Los Datos son originalmente Gammas, pero los probaremos para Exponenciales-------
n = 100
#X= rgamma(15, shape=1, scale = 3) #Recuderga que cuando shape=1 la gamma es una exponencial. 
#X = rnorm(n, mean = 0, sd = 1)
X = c(4239,30000,24000,50000,6000,9251,32000,3950,6000,6400,17900,6500,15000,5070,7450,9500,50000,50000,9330,18000,10322,3700,16700,11500,15000,6400,4500,44000,29560,15500,21000,86000,16000,14000)
X = c( 21.2, 20.0, 22.8, 21.6, 22.0, 22.9, 21.9, 22.2, 23.2)

X = c(19.8, 20.9, 21.5, 20.0, 21.0, 22.0, 20.3, 21.0, 22.0, 20.8, 21.0, 22.1, 20.9, 21.2, 22.3)

X = c(7862683,7539194,7357216,7285069,7294089,7286848,7517699,7778555,8283165,8644360,8840013,8989629,
9077733,9045176,8952611,8910423,8950400,8774206,8460669,8774347,8866346,8625582,8366715,7960311)

Y = c(8024746,7712778,7517321,7453651,7457063,7513469,7736337,8091317,8500986,8879247,9096904,9212742,
9320006,9413999,9320699,9292964,9296340,9161342,8893853,8643769,8945712,9027930,8818646,8451947)



#----------------Para esto debemos calcular el estimador de m?xima verosimlitud para una exponencial---

T1<- sum(X)# estadistica suficiente
T2 <- sum(X*X)
n= length(X) # Cantidad de observaciones en vector
theta_gorro= T1/n #emv de theta (la media de la exponencial)
sigma_gorro= (T2/n-T1^2/n^2)^(1/2)

X_sort= sort(X)
x_pp= seq(1/(n+1), n/(n+1), length=n)

index<- seq(1,n,by=1)

#--------------Por la desigualdad de bonferroni se calcular? la probabilidad de cada intervalo--------

alpha_deseado= 0.95 # La probabilidad m?nima que se quiere para toda la gr?fica

beta_intervalo= (alpha_deseado-1)/n + 1 #La probabilidad para cada intervalo

Int_inf_betas= qbeta((1-beta_intervalo)/2, index, n+1-index)

Int_sup_betas= qbeta((1+beta_intervalo)/2, index, n+1-index)

# PP exponential 

par(pty="s")

#Mus_exponential<- pexp(X_sort, rate= 1/theta_gorro)
Mus_exponential<- pnorm(X_sort, mean = theta_gorro, sd = sigma_gorro, lower.tail = TRUE, log.p = FALSE)

plot(x_pp, Mus_exponential, pch="*", xlim=c(0,1), ylim=c(0,1), xaxs="i",yaxs="i",
     xlab="k/(n+1)", ylab=expression(theta[2](k)), main="Gráfica PP NORMAL \n HORARIO VERANO")

lines(x_pp, Int_sup_betas, lty=2, col="red")
lines(x_pp, Int_inf_betas, lty=2, col="red")
abline(a=0,b=1,lty=1,col="blue")
grid()

# QQ exponential

#Q_exponential<- qexp(x_pp, rate=1/theta_gorro)
Q_exponential<- qnorm(x_pp, mean = theta_gorro, sd = sigma_gorro, lower.tail = TRUE, log.p = FALSE)

#Int_inf_exp<- qexp(Int_inf_betas, rate=1/theta_gorro)
Int_inf_exp<- qnorm(Int_inf_betas, mean = theta_gorro, sd = sigma_gorro, lower.tail = TRUE, log.p = FALSE)

#Int_sup_exp<- qexp(Int_sup_betas, rate=1/theta_gorro)
Int_sup_exp<- qnorm(Int_sup_betas, mean = theta_gorro, sd = sigma_gorro, lower.tail = TRUE, log.p = FALSE)

plot(Q_exponential, X_sort, pch="*", xaxs="i",yaxs="i",
     xlab= "Cuantiles exponenciales estimados", ylab="Cuantiles empiricos", main="Gr?fica QQ exponencial")

lines(Q_exponential, Int_sup_exp, lty=2, col="red")
lines(Q_exponential, Int_inf_exp, lty=2, col="red")
abline(a=0,b=1,lty=1,col="blue")
grid()

par(pty="m")

X1 = c(7495891,7104540,6942036,6812652,6713419,6729651,6693093,6639208,6912511,7127233,7245860,7338979,
7328129,7355726,7323133,7249348,7259550,7277468,7230829,7928045,8181400,8033854,7714514,7258927,6867044,
6648967,6572386,6521881,6562286,6670592,7054672,7524905,8175665,8676862,8922367,9118004,9263407,9351802,
9304774,9304058,9289618,9158510,8804089,9001680,9110401,8869358,8591238,8184129,7760723,7536584,7365828,
7287631,7294285,7343279,7509249,7880534,8458298,8762687,8939297,9169285,9293386,9365595,9328001,9325316,
9288900,9118805,8699562,9004729,9136752,8911294,8579734,8179033,7862683,7539194,7357216,7285069,7294089,
7286848,7517699,7778555,8283165,8644360,8840013,8989629,9077733,9045176,8952611,8910423,8950400,8774206,
8460669,8774347,8866346,8625582,8366715,7960311,7613878,7315159,7150993,7022632,6947772,6958720,6972824,
7062880,7419257,7654975,7844047,7926615,8009600,7932054,7901591,7880963,7793360,7648043,7469526,7758862,
7891433,7713470,7484117,7140829,6690731,6485796,6370068,6252743,6221238,6149316,6016096,5907157,6071793,
6336719,6424551,6436016,6494357,6492245,6415512,6338829,6320971,6270004,6254867,6629783,6883956,6746001,
6505657,6251766,5952002,5656146,5596290,5516600,5514169,5604368,5627848,5842514,6226250,6521818,6723445,
6864009,6900023,6959337,6948046,7018179,6928213,6930913,6878692,7357916,7592985,7436322,7091846,6664122)

X2 = c(6397907,6056983,5926158,5871242,5885725,5919511,5980174,6057156,6300914,6537050,6715458,6730349,
6711681,6696652,6725232,6741488,6734360,6657978,6759730,7409971,7640542,7460061,7063249,6670356,6315524,
6213298,6189401,6212654,6331037,6788294,7354312,7823373,8327465,8636512,8843438,9022018,9089399,9055710,
9087046,9131574,8983724,8691547,8402426,8708940,8813665,8672827,8397623,7840172,7586214,7403057,7303182,
7275394,7307662,7575028,7966019,8352190,8722550,8923940,9090272,9200934,9301790,9263623,9232565,9207162,
9064469,8807387,8529098,8819556,8973652,8811980,8444135,8024746,7712778,7517321,7453651,7457063,7513469,
7736337,8091317,8500986,8879247,9096904,9212742,9320006,9413999,9320699,9292964,9296340,9161342,8893853,
8643769,8945712,9027930,8818646,8451947,7940563,7630371,7449187,7373774,7394532,7477969,7732297,8165854,
8530536,8911476,9101904,9237641,9409931,9500314,9436266,9392635,9384966,9245866,8960082,8693484,8939778,
9014336,8801597,8554423,8087004,7728260,7590364,7455913,7458393,7496963,7817371,8199424,8559006,8964246,
9147428,9293619,9399131,9393267,9366878,9309457,9308719,9073289,8774566,8470656,8733145,8879352,8753082,
8482652,8104085,7747251,7556507,7405853,7391441,7408688,7583950,7818623,8102942,8479860,8628892,8697784,
8808964,8702672,8531285,8439474,8374318,8275840,8093988,8090578,8588543,8691026,8429424,7971869)

Y1 = seq(0,24*7-1)
Y2 = seq(0,24*7-2)
X1 = X1/1000
X2 = X2/1000
plot(Y1,X1,col="blue",type="l",xlim=c(0,165), ylim=c(5000,10000), xaxs="i",yaxs="i")
par(new=TRUE)
plot(Y2,X2,col="red",type="l",xlim=c(0,165), ylim=c(5000,10000), xaxs="i",yaxs="i")
